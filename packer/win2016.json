{
  "variables": {
    "vpc_id": "{{env `VPC_ID`}}",
    "subnet_id": "{{env `SUBNET_ID`}}"
  },
  "builders": [
    {
      "type": "amazon-ebs",
      "region": "ap-southeast-2",
      "instance_type": "t2.micro",
      "vpc_id": "{{user `vpc_id`}}",
      "subnet_id": "{{user `subnet_id`}}",
      "user_data_file": "/workdir/scripts/SetUpWinRM.ps1",
      "communicator": "winrm",
      "winrm_username": "Administrator",
      "associate_public_ip_address": false,
      "winrm_use_ssl": true,
      "winrm_insecure": true,
      "source_ami_filter": {
          "filters": {
            "name": "Windows_Server-2012-R2_RTM-English-64Bit-Base-*"
          },
          "owners": ["801119661308"],
          "most_recent": true
      },
      "ami_name": "win16-platform-ami{{timestamp}}",
      "ami_description": "Cevo Amazon Win16 Platform AMI",
      "tags": {
        "Name": "Cevo Amazon Win16 Pltform AMI",
        "Application": "common",
        "Owner": "someone@cevo.com.au",
        "Date": "{{isotime}}"
      }
    }
  ],
  "provisioners": [
      {
          "type": "powershell",
          "scripts": [
              "/workdir/scripts/EC2Config.ps1",
              "/workdir/scripts/BundleConfig.ps1",
              "/workdir/scripts/SetUpDevTools.ps1"
          ]
      },
      {
          "type": "file",
          "source": "/workdir/tests",
          "destination": "C:/Windows/Temp"
      },
      {
          "type": "powershell",
          "script": "/workdir/scripts/RunTests.ps1"
      },
      {
          "type": "file",
          "source": "TestResults.xml",
          "destination": "/workdir/TestResults.xml",
          "direction": "download"
      }
  ],
  "post-processors": [
      {
          "type": "manifest"
      }
  ]
}
